<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Galactic Federation - Space Heroes CTF | Jaedyn Okabe</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Galactic Federation - Space Heroes CTF" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Category: RE" />
<meta property="og:description" content="Category: RE" />
<link rel="canonical" href="http://localhost:4000/space/heroes/2023/04/23/Galactic-Federation-SpaceHeroes.html" />
<meta property="og:url" content="http://localhost:4000/space/heroes/2023/04/23/Galactic-Federation-SpaceHeroes.html" />
<meta property="og:site_name" content="Jaedyn Okabe" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-23T18:10:18-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Galactic Federation - Space Heroes CTF" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-23T18:10:18-04:00","datePublished":"2023-04-23T18:10:18-04:00","description":"Category: RE","headline":"Galactic Federation - Space Heroes CTF","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/space/heroes/2023/04/23/Galactic-Federation-SpaceHeroes.html"},"url":"http://localhost:4000/space/heroes/2023/04/23/Galactic-Federation-SpaceHeroes.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Jaedyn Okabe" /><body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Jaedyn Okabe</a><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
  
          <div class="trigger"><a class="page-link" href="/about/">About</a></div>
        </nav></div>
  </header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Galactic Federation - Space Heroes CTF</h1>
    <p class="post-meta"><time class="dt-published" datetime="2023-04-23T18:10:18-04:00" itemprop="datePublished">
        Apr 23, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Category: RE</p>

<p>Points: 221</p>

<hr />

<p>We’re given a bin file that brings us to a login page when we try running it. Pulling up Ghidra to decompile the file we can see what the login error checking is.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++">    <span class="n">bVar1</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">obfuscate</span><span class="p">(</span><span class="n">local_78</span><span class="p">);</span>
    <span class="n">bVar2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">local_78</span><span class="p">,</span><span class="s">"hktpu"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bVar2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">obfuscate</span><span class="p">(</span><span class="n">local_58</span><span class="p">);</span>
      <span class="n">bVar1</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="n">bVar2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">local_58</span><span class="p">,</span><span class="s">"8fs7}:f~Y;unS:yfqL;uZ"</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bVar2</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_00403dc9</span><span class="p">;</span>
      <span class="n">bVar2</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
<span class="nl">LAB_00403dc9:</span>
      <span class="n">bVar2</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span></code></pre></figure>

<p>We see in the login_page function that it compares the user (var local_78) to <strong>‘hktpu’</strong> and the password (local_58) to <strong>‘8fs7}:f~Y;unS:yfqL;uZ’</strong>. We can also see here that the inputs are going through a function called <em>obfuscate()</em> which is altering them.</p>

<p>So using ghidra to open that function we can see that each character gets the char <em>‘\a’</em> added to it.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">basic_string</span> <span class="o">*</span> <span class="nf">obfuscate</span><span class="p">(</span><span class="n">basic_string</span> <span class="o">*</span><span class="n">param_1</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">pcVar1</span><span class="p">;</span>
  <span class="n">ulong</span> <span class="n">uVar2</span><span class="p">;</span>
  <span class="n">ulong</span> <span class="n">in_RSI</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">local_1c</span><span class="p">;</span>
  
  <span class="n">local_1c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">uVar2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">uVar2</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ulong</span><span class="p">)(</span><span class="kt">long</span><span class="p">)</span><span class="n">local_1c</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="n">pcVar1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span>
                     <span class="k">operator</span><span class="p">[](</span><span class="n">in_RSI</span><span class="p">);</span>
    <span class="o">*</span><span class="n">pcVar1</span> <span class="o">=</span> <span class="o">*</span><span class="n">pcVar1</span> <span class="o">+</span> <span class="sc">'\a'</span><span class="p">;</span> <span class="c1">// this is the line we care about </span>
    <span class="n">local_1c</span> <span class="o">=</span> <span class="n">local_1c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">basic_string</span>
            <span class="p">(</span><span class="n">param_1</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">param_1</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>All we need to do is write a quick script to subtract this value from each of the chars (or do it manually by converting the ascii values to integers first).</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt;iostream&gt;
#include &lt;string&gt;
</span>
<span class="c1">// all written in c++</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="nf">deobfuscate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">input</span><span class="p">){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">output</span><span class="p">;</span>
    <span class="n">output</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">char</span> <span class="n">x</span> <span class="o">:</span> <span class="n">input</span><span class="p">){</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="sc">'\a'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">obfuscated_user</span> <span class="o">=</span> <span class="s">"hktpu"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">obfuscated_password</span> <span class="o">=</span> <span class="s">"8fs7}:f~Y;unS:yfqL;uZ"</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">deobfuscated_user</span> <span class="o">=</span> <span class="n">deobfuscate</span><span class="p">(</span><span class="n">obfuscated_user</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">deobfuscated_password</span> <span class="o">=</span> <span class="n">deobfuscate</span><span class="p">(</span><span class="n">obfuscated_password</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Deobfuscated user: "</span> <span class="o">&lt;&lt;</span> <span class="n">deobfuscated_user</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Deobfuscated password: "</span> <span class="o">&lt;&lt;</span> <span class="n">deobfuscated_password</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Deobfuscated user: admin
Deobfuscated password: 1_l0v3_wR4ngL3r_jE4nS
</code></pre></div></div>

<p>Now that we’re in, we’re given lots of options and each of those options have even more choices. So instead of blindly trying to find something we can go back to ghidra and look for a function that prints the flag. From there we can usually work backwards and get the desired output.</p>

<p>We see a <em>print_flag</em> function so now we can find all references to that function (rick-clicking and selecting ‘show references to’). Following the first reference we see the <em>‘collapse_economy’</em> function. Following that function too we finally see the one we need to interact with, which is <em>‘adjust_economy’</em>.</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++">    <span class="k">if</span> <span class="p">((</span><span class="n">currency</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="n">bVar1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="k">operator</span><span class="o">==</span><span class="p">((</span><span class="n">basic_string</span> <span class="o">*</span><span class="p">)</span><span class="n">galactic_currency</span><span class="p">[</span><span class="n">abi</span><span class="o">:</span><span class="n">cxx11</span><span class="p">],</span><span class="s">"usd"</span><span class="p">),</span> <span class="n">bVar1</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">bVar1</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">bVar1</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bVar1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">collapse_economy</span><span class="p">();</span>
    <span class="p">}</span></code></pre></figure>

<p>Within the <em>‘adjust_economy’</em> function, <em>‘collapse_economy’</em> will be called if currency == 0 and the galactic_currency == ‘usd’.</p>

<p>So starting with the easy one we can change galactic currency to usd. Either keep using ghidra to find the right function or just play around with the program until you find the <em>presidential_decree</em> function and from there we can use the <em>change_galactic_currency</em> option which takes any string input and set it to usd.</p>

<p>Then we can use head back to the <em>‘adjust_economy’</em> function and use <em>inflate_currency</em> which takes an integer as a percentage to change the currency value. Before we try adding any values though we can check what our input will do. We see</p>
<figure class="highlight"><pre><code class="language-c--" data-lang="c++"> <span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span> <span class="o">+</span> <span class="p">(</span><span class="n">var</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">currency</span> </code></pre></figure>
<p>where var is the percentage we input (var is not the original variable name, ghidra lets you rename variables which is what I have done to make reading the code easier). Given this info, we can input <strong>-100</strong> or any value you want that will cause the currency to drop to 0 or below.</p>

<p>As soon as both changes are made, a series of text dialogues print out along with the flag: <strong>shctf{w4it_uH_wh0s_P4y1Ng_m3<em>2_y3L1</em>@_tH15_gUy?}</strong></p>

  </div><a class="u-url" href="/space/heroes/2023/04/23/Galactic-Federation-SpaceHeroes.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/"></data>
  
    <div class="wrapper">
  
      <div class="footer-col-wrapper">
        <div class="footer-col">
          <p class="feed-subscribe">
            <a href="http://localhost:4000/feed.xml">
              
            </a>
          </p>
        </div>
        <div class="footer-col">
          <p>Hi I&#39;m a undergrad student at Queen&#39;s University pursuing a degree in Computing with a focus in security. This site holds writeups, my resume, CTF stats, and what I  am currently working on in cybersecurity.</p>
        </div>
      </div>
  
      <div class="social-links"><ul class="social-media-list"><li>
    <a rel="me" href="https://github.com/jaedyno15" target="_blank" title="github">
      <svg class="svg-icon grey">
        <use xlink:href="/assets/minima-social-icons.svg#github"></use>
      </svg>
    </a>
  </li><li>
    <a rel="me" href="https://www.linkedin.com/in/jaedyn-okabe" target="_blank" title="linkedin">
      <svg class="svg-icon grey">
        <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
      </svg>
    </a>
  </li><li>
    <a rel="me" href="https://tryhackme.com/p/jay4221" target="_blank" title="tryhackme">
      <svg class="svg-icon grey">
        <use xlink:href="/assets/minima-social-icons.svg#tryhackme"></use>
      </svg>
    </a>
  </li><li>
    <a rel="me" href="https://ctftime.org/user/154304" target="_blank" title="ctftime">
      <svg class="svg-icon grey">
        <use xlink:href="/assets/minima-social-icons.svg#ctftime"></use>
      </svg>
    </a>
  </li></ul></div>
  
    </div>
  
  </footer></body>

</html>